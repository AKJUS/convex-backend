FROM node:18

WORKDIR /app

# Clone the repository
RUN git clone https://github.com/get-convex/convex-backend.git .

# Install dependencies and build
WORKDIR /app/npm-packages/dashboard-self-hosted
RUN npm install -g @microsoft/rush
RUN rush update
RUN rush build -t dashboard-self-hosted

EXPOSE 6791
CMD ["npm", "start"]